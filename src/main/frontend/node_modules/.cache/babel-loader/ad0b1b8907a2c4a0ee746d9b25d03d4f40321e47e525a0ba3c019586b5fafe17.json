{"ast":null,"code":"import _objectSpread from\"/Users/chan/Baektracker/src/main/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useSelector}from\"react-redux\";import{createPortal}from\"react-dom\";import{useEffect,useRef}from\"react\";import useModal from\"../hook/useModal\";import{ObjectUtils}from\"../utils/ObjectUtil\";import{ModalSet}from\"../../modal/ModalSet\";import{jsx as _jsx,Fragment as _Fragment}from\"react/jsx-runtime\";const M_TYPE={MENU:'MENU',LAYER:'LAYER',RENDERLESS:'RENDERLESS',TOOLTIP:'TOOLTIP'};function ModalContainer(){const modal=useModal();const modalList=useSelector(state=>state.modalReducer);const topComponentRef=useRef(null);const handleRef=node=>{if(node){topComponentRef.current=node;}};useEffect(()=>{if(ObjectUtils.isEmpty(modalList.list)){return;}const{type,modalName}=modalList.list[modalList.list.length-1];const onClickCaptureEvent=e=>{if(topComponentRef.current&&!topComponentRef.current.contains(e.target)){modal.closeAndLockModal(modalName);window.removeEventListener('mousedown',onClickCaptureEvent,true);window.removeEventListener('keydown',onKeydownCaptureEvent,true);}};const onClickBubbleEvent=e=>{modal.unlockModal();window.removeEventListener('click',onClickBubbleEvent,false);};const onKeydownCaptureEvent=e=>{if(e.keyCode===27){modal.closeModal(modalName);window.removeEventListener('keydown',onKeydownCaptureEvent,true);window.removeEventListener('mousedown',onClickCaptureEvent,true);window.removeEventListener('click',onClickBubbleEvent,false);}};// 모든 흐름이 끝난 후 이벤트 리스너를 붙이도록 비동기적으로 처리\nconst attachListenerTimer=setTimeout(()=>{if(type===M_TYPE.LAYER||type===M_TYPE.MENU||type===M_TYPE.RENDERLESS){window.addEventListener('click',onClickBubbleEvent,false);window.addEventListener('mousedown',onClickCaptureEvent,true);// true: capturing, false: bubbling\n}if(type===M_TYPE.MENU||type===M_TYPE.LAYER||type===M_TYPE.RENDERLESS){window.addEventListener('keydown',onKeydownCaptureEvent,true);}},10);return()=>{clearTimeout(attachListenerTimer);window.removeEventListener('keydown',onKeydownCaptureEvent,true);window.removeEventListener('mousedown',onClickCaptureEvent,true);// window.removeEventListener('click', onClickBubbleEvent, false)\n// bubbling의 경우에는 미리 삭제하면 안되기 때문에 주석처리\n};},[modalList.list]);let topIndex=0;let topScrollIndex=0;modalList.list.forEach((_ref,index)=>{let{modalName,type,props}=_ref;if(type===M_TYPE.MENU||type===M_TYPE.LAYER||type===M_TYPE.RENDERLESS){topIndex=index;}if(type===M_TYPE.LAYER||type===M_TYPE.MENU){topScrollIndex=index;}});const lastIndex=modalList.list.length-1;const renderModal=modalList.list.filter(_ref2=>{let{modalName,type,props}=_ref2;if(ObjectUtils.isEmpty(modalName)||ObjectUtils.isEmpty(type)){return false;}if(type===M_TYPE.RENDERLESS){if(props.ref){topComponentRef.current=props.ref;}return false;}return true;}).map((_ref3,index)=>{let{modalName,type,onopen,onclose,props}=_ref3;let windowBlocked=false;if(type===M_TYPE.LAYER&&index===lastIndex){windowBlocked=true;}if(index===topIndex){const ModalComponent=ModalSet[modalName];return/*#__PURE__*/_jsx(ModalComponent,_objectSpread({scrollable:true,modalRef:handleRef,windowBlocked:windowBlocked},props),modalName);}const ModalComponent=ModalSet[modalName];let scrollable=false;if((type===M_TYPE.LAYER||type===M_TYPE.MENU)&&index===topScrollIndex){scrollable=true;}return/*#__PURE__*/_jsx(ModalComponent,_objectSpread({scrollable:scrollable,windowBlocked:windowBlocked},props),modalName);});return/*#__PURE__*/createPortal(/*#__PURE__*/_jsx(_Fragment,{children:renderModal}),document.getElementById('root'));}export default ModalContainer;","map":{"version":3,"names":["useSelector","createPortal","useEffect","useRef","useModal","ObjectUtils","ModalSet","jsx","_jsx","Fragment","_Fragment","M_TYPE","MENU","LAYER","RENDERLESS","TOOLTIP","ModalContainer","modal","modalList","state","modalReducer","topComponentRef","handleRef","node","current","isEmpty","list","type","modalName","length","onClickCaptureEvent","e","contains","target","closeAndLockModal","window","removeEventListener","onKeydownCaptureEvent","onClickBubbleEvent","unlockModal","keyCode","closeModal","attachListenerTimer","setTimeout","addEventListener","clearTimeout","topIndex","topScrollIndex","forEach","_ref","index","props","lastIndex","renderModal","filter","_ref2","ref","map","_ref3","onopen","onclose","windowBlocked","ModalComponent","_objectSpread","scrollable","modalRef","children","document","getElementById"],"sources":["/Users/chan/Baektracker/src/main/frontend/src/js/setup/modal/ModalContainer.js"],"sourcesContent":["import {useSelector} from \"react-redux\";\nimport {createPortal} from \"react-dom\";\nimport {useEffect, useRef} from \"react\";\nimport useModal from \"../hook/useModal\";\nimport {ObjectUtils} from \"../utils/ObjectUtil\";\nimport {ModalSet} from \"../../modal/ModalSet\";\n\nconst M_TYPE = {\n    MENU: 'MENU',\n    LAYER: 'LAYER',\n    RENDERLESS: 'RENDERLESS',\n    TOOLTIP: 'TOOLTIP'\n}\n\nfunction ModalContainer(){\n    const modal = useModal();\n    const modalList : Object<string,Array> = useSelector(state=>state.modalReducer);\n    const topComponentRef = useRef(null);\n\n    const handleRef = (node) => {\n        if (node) {\n            topComponentRef.current = node;\n        }\n    };\n\n    useEffect(()=>{\n        if(ObjectUtils.isEmpty(modalList.list)){\n            return;\n        }\n\n        const {type, modalName} = modalList.list[modalList.list.length-1];\n        const onClickCaptureEvent = (e: MouseEvent)=>{\n            if(topComponentRef.current && !topComponentRef.current.contains(e.target)){\n                modal.closeAndLockModal(modalName)\n                window.removeEventListener('mousedown', onClickCaptureEvent, true)\n                window.removeEventListener('keydown', onKeydownCaptureEvent, true)\n            }\n        }\n\n        const onClickBubbleEvent = (e)=>{\n            modal.unlockModal()\n            window.removeEventListener('click', onClickBubbleEvent, false)\n        }\n\n        const onKeydownCaptureEvent = (e: KeyboardEvent)=>{\n            if(e.keyCode === 27){\n                modal.closeModal(modalName);\n\n                window.removeEventListener('keydown', onKeydownCaptureEvent, true)\n                window.removeEventListener('mousedown', onClickCaptureEvent, true)\n                window.removeEventListener('click', onClickBubbleEvent, false)\n            }\n        }\n\n        // 모든 흐름이 끝난 후 이벤트 리스너를 붙이도록 비동기적으로 처리\n        const attachListenerTimer = setTimeout(()=>{\n            if(type === M_TYPE.LAYER || type === M_TYPE.MENU || type === M_TYPE.RENDERLESS){\n                window.addEventListener('click', onClickBubbleEvent, false)\n                window.addEventListener('mousedown', onClickCaptureEvent, true) // true: capturing, false: bubbling\n            }\n\n            if(type === M_TYPE.MENU || type === M_TYPE.LAYER || type === M_TYPE.RENDERLESS){\n                window.addEventListener('keydown', onKeydownCaptureEvent, true)\n            }\n        }, 10)\n\n        return ()=>{\n            clearTimeout(attachListenerTimer);\n            window.removeEventListener('keydown', onKeydownCaptureEvent, true)\n            window.removeEventListener('mousedown', onClickCaptureEvent, true)\n            // window.removeEventListener('click', onClickBubbleEvent, false)\n            // bubbling의 경우에는 미리 삭제하면 안되기 때문에 주석처리\n        }\n    },[modalList.list])\n\n    let topIndex = 0;\n    let topScrollIndex = 0;\n    modalList.list.forEach(({modalName, type, props}, index)=>{\n        if(type === M_TYPE.MENU || type === M_TYPE.LAYER || type === M_TYPE.RENDERLESS){\n            topIndex = index\n        }\n        if(type === M_TYPE.LAYER || type === M_TYPE.MENU){\n            topScrollIndex = index\n        }\n    })\n\n    const lastIndex = modalList.list.length - 1;\n    const renderModal = modalList.list.filter(({modalName, type, props})=>{\n        if(ObjectUtils.isEmpty(modalName) || ObjectUtils.isEmpty(type)){\n            return false;\n        }\n        if(type === M_TYPE.RENDERLESS){\n            if(props.ref){\n                topComponentRef.current = props.ref;\n            }\n            return false;\n        }\n        return true;\n    }).map(({modalName, type, onopen, onclose, props}, index)=>{\n        let windowBlocked = false;\n        if(type === M_TYPE.LAYER && index === lastIndex){\n            windowBlocked = true;\n        }\n\n        if(index === topIndex){\n            const ModalComponent = ModalSet[modalName];\n            return <ModalComponent scrollable={true} modalRef={handleRef} windowBlocked={windowBlocked} key={modalName} {...props}/>\n        }\n\n        const ModalComponent = ModalSet[modalName];\n\n        let scrollable = false;\n        if((type === M_TYPE.LAYER || type === M_TYPE.MENU) && index === topScrollIndex){\n            scrollable = true;\n        }\n\n        return <ModalComponent scrollable={scrollable} windowBlocked={windowBlocked} key={modalName} {...props}/>\n    });\n\n    return createPortal(\n        <>\n            {renderModal}\n        </>, document.getElementById('root')\n    )\n}\n\nexport default ModalContainer;"],"mappings":"8HAAA,OAAQA,WAAW,KAAO,aAAa,CACvC,OAAQC,YAAY,KAAO,WAAW,CACtC,OAAQC,SAAS,CAAEC,MAAM,KAAO,OAAO,CACvC,MAAO,CAAAC,QAAQ,KAAM,kBAAkB,CACvC,OAAQC,WAAW,KAAO,qBAAqB,CAC/C,OAAQC,QAAQ,KAAO,sBAAsB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,QAAA,IAAAC,SAAA,yBAE9C,KAAM,CAAAC,MAAM,CAAG,CACXC,IAAI,CAAE,MAAM,CACZC,KAAK,CAAE,OAAO,CACdC,UAAU,CAAE,YAAY,CACxBC,OAAO,CAAE,SACb,CAAC,CAED,QAAS,CAAAC,cAAcA,CAAA,CAAE,CACrB,KAAM,CAAAC,KAAK,CAAGb,QAAQ,CAAC,CAAC,CACxB,KAAM,CAAAc,SAAgC,CAAGlB,WAAW,CAACmB,KAAK,EAAEA,KAAK,CAACC,YAAY,CAAC,CAC/E,KAAM,CAAAC,eAAe,CAAGlB,MAAM,CAAC,IAAI,CAAC,CAEpC,KAAM,CAAAmB,SAAS,CAAIC,IAAI,EAAK,CACxB,GAAIA,IAAI,CAAE,CACNF,eAAe,CAACG,OAAO,CAAGD,IAAI,CAClC,CACJ,CAAC,CAEDrB,SAAS,CAAC,IAAI,CACV,GAAGG,WAAW,CAACoB,OAAO,CAACP,SAAS,CAACQ,IAAI,CAAC,CAAC,CACnC,OACJ,CAEA,KAAM,CAACC,IAAI,CAAEC,SAAS,CAAC,CAAGV,SAAS,CAACQ,IAAI,CAACR,SAAS,CAACQ,IAAI,CAACG,MAAM,CAAC,CAAC,CAAC,CACjE,KAAM,CAAAC,mBAAmB,CAAIC,CAAa,EAAG,CACzC,GAAGV,eAAe,CAACG,OAAO,EAAI,CAACH,eAAe,CAACG,OAAO,CAACQ,QAAQ,CAACD,CAAC,CAACE,MAAM,CAAC,CAAC,CACtEhB,KAAK,CAACiB,iBAAiB,CAACN,SAAS,CAAC,CAClCO,MAAM,CAACC,mBAAmB,CAAC,WAAW,CAAEN,mBAAmB,CAAE,IAAI,CAAC,CAClEK,MAAM,CAACC,mBAAmB,CAAC,SAAS,CAAEC,qBAAqB,CAAE,IAAI,CAAC,CACtE,CACJ,CAAC,CAED,KAAM,CAAAC,kBAAkB,CAAIP,CAAC,EAAG,CAC5Bd,KAAK,CAACsB,WAAW,CAAC,CAAC,CACnBJ,MAAM,CAACC,mBAAmB,CAAC,OAAO,CAAEE,kBAAkB,CAAE,KAAK,CAAC,CAClE,CAAC,CAED,KAAM,CAAAD,qBAAqB,CAAIN,CAAgB,EAAG,CAC9C,GAAGA,CAAC,CAACS,OAAO,GAAK,EAAE,CAAC,CAChBvB,KAAK,CAACwB,UAAU,CAACb,SAAS,CAAC,CAE3BO,MAAM,CAACC,mBAAmB,CAAC,SAAS,CAAEC,qBAAqB,CAAE,IAAI,CAAC,CAClEF,MAAM,CAACC,mBAAmB,CAAC,WAAW,CAAEN,mBAAmB,CAAE,IAAI,CAAC,CAClEK,MAAM,CAACC,mBAAmB,CAAC,OAAO,CAAEE,kBAAkB,CAAE,KAAK,CAAC,CAClE,CACJ,CAAC,CAED;AACA,KAAM,CAAAI,mBAAmB,CAAGC,UAAU,CAAC,IAAI,CACvC,GAAGhB,IAAI,GAAKhB,MAAM,CAACE,KAAK,EAAIc,IAAI,GAAKhB,MAAM,CAACC,IAAI,EAAIe,IAAI,GAAKhB,MAAM,CAACG,UAAU,CAAC,CAC3EqB,MAAM,CAACS,gBAAgB,CAAC,OAAO,CAAEN,kBAAkB,CAAE,KAAK,CAAC,CAC3DH,MAAM,CAACS,gBAAgB,CAAC,WAAW,CAAEd,mBAAmB,CAAE,IAAI,CAAC,CAAC;AACpE,CAEA,GAAGH,IAAI,GAAKhB,MAAM,CAACC,IAAI,EAAIe,IAAI,GAAKhB,MAAM,CAACE,KAAK,EAAIc,IAAI,GAAKhB,MAAM,CAACG,UAAU,CAAC,CAC3EqB,MAAM,CAACS,gBAAgB,CAAC,SAAS,CAAEP,qBAAqB,CAAE,IAAI,CAAC,CACnE,CACJ,CAAC,CAAE,EAAE,CAAC,CAEN,MAAO,IAAI,CACPQ,YAAY,CAACH,mBAAmB,CAAC,CACjCP,MAAM,CAACC,mBAAmB,CAAC,SAAS,CAAEC,qBAAqB,CAAE,IAAI,CAAC,CAClEF,MAAM,CAACC,mBAAmB,CAAC,WAAW,CAAEN,mBAAmB,CAAE,IAAI,CAAC,CAClE;AACA;AACJ,CAAC,CACL,CAAC,CAAC,CAACZ,SAAS,CAACQ,IAAI,CAAC,CAAC,CAEnB,GAAI,CAAAoB,QAAQ,CAAG,CAAC,CAChB,GAAI,CAAAC,cAAc,CAAG,CAAC,CACtB7B,SAAS,CAACQ,IAAI,CAACsB,OAAO,CAAC,CAAAC,IAAA,CAA2BC,KAAK,GAAG,IAAlC,CAACtB,SAAS,CAAED,IAAI,CAAEwB,KAAK,CAAC,CAAAF,IAAA,CAC5C,GAAGtB,IAAI,GAAKhB,MAAM,CAACC,IAAI,EAAIe,IAAI,GAAKhB,MAAM,CAACE,KAAK,EAAIc,IAAI,GAAKhB,MAAM,CAACG,UAAU,CAAC,CAC3EgC,QAAQ,CAAGI,KAAK,CACpB,CACA,GAAGvB,IAAI,GAAKhB,MAAM,CAACE,KAAK,EAAIc,IAAI,GAAKhB,MAAM,CAACC,IAAI,CAAC,CAC7CmC,cAAc,CAAGG,KAAK,CAC1B,CACJ,CAAC,CAAC,CAEF,KAAM,CAAAE,SAAS,CAAGlC,SAAS,CAACQ,IAAI,CAACG,MAAM,CAAG,CAAC,CAC3C,KAAM,CAAAwB,WAAW,CAAGnC,SAAS,CAACQ,IAAI,CAAC4B,MAAM,CAACC,KAAA,EAA4B,IAA3B,CAAC3B,SAAS,CAAED,IAAI,CAAEwB,KAAK,CAAC,CAAAI,KAAA,CAC/D,GAAGlD,WAAW,CAACoB,OAAO,CAACG,SAAS,CAAC,EAAIvB,WAAW,CAACoB,OAAO,CAACE,IAAI,CAAC,CAAC,CAC3D,MAAO,MAAK,CAChB,CACA,GAAGA,IAAI,GAAKhB,MAAM,CAACG,UAAU,CAAC,CAC1B,GAAGqC,KAAK,CAACK,GAAG,CAAC,CACTnC,eAAe,CAACG,OAAO,CAAG2B,KAAK,CAACK,GAAG,CACvC,CACA,MAAO,MAAK,CAChB,CACA,MAAO,KAAI,CACf,CAAC,CAAC,CAACC,GAAG,CAAC,CAAAC,KAAA,CAA4CR,KAAK,GAAG,IAAnD,CAACtB,SAAS,CAAED,IAAI,CAAEgC,MAAM,CAAEC,OAAO,CAAET,KAAK,CAAC,CAAAO,KAAA,CAC7C,GAAI,CAAAG,aAAa,CAAG,KAAK,CACzB,GAAGlC,IAAI,GAAKhB,MAAM,CAACE,KAAK,EAAIqC,KAAK,GAAKE,SAAS,CAAC,CAC5CS,aAAa,CAAG,IAAI,CACxB,CAEA,GAAGX,KAAK,GAAKJ,QAAQ,CAAC,CAClB,KAAM,CAAAgB,cAAc,CAAGxD,QAAQ,CAACsB,SAAS,CAAC,CAC1C,mBAAOpB,IAAA,CAACsD,cAAc,CAAAC,aAAA,EAACC,UAAU,CAAE,IAAK,CAACC,QAAQ,CAAE3C,SAAU,CAACuC,aAAa,CAAEA,aAAc,EAAqBV,KAAK,EAApBvB,SAAsB,CAAC,CAC5H,CAEA,KAAM,CAAAkC,cAAc,CAAGxD,QAAQ,CAACsB,SAAS,CAAC,CAE1C,GAAI,CAAAoC,UAAU,CAAG,KAAK,CACtB,GAAG,CAACrC,IAAI,GAAKhB,MAAM,CAACE,KAAK,EAAIc,IAAI,GAAKhB,MAAM,CAACC,IAAI,GAAKsC,KAAK,GAAKH,cAAc,CAAC,CAC3EiB,UAAU,CAAG,IAAI,CACrB,CAEA,mBAAOxD,IAAA,CAACsD,cAAc,CAAAC,aAAA,EAACC,UAAU,CAAEA,UAAW,CAACH,aAAa,CAAEA,aAAc,EAAqBV,KAAK,EAApBvB,SAAsB,CAAC,CAC7G,CAAC,CAAC,CAEF,mBAAO3B,YAAY,cACfO,IAAA,CAAAE,SAAA,EAAAwD,QAAA,CACKb,WAAW,CACd,CAAC,CAAEc,QAAQ,CAACC,cAAc,CAAC,MAAM,CACvC,CAAC,CACL,CAEA,cAAe,CAAApD,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}