{"ast":null,"code":"var _jsxFileName = \"/Users/chan/Baektracker/src/main/frontend/src/js/setup/modal/ModalContainer.js\",\n  _s = $RefreshSig$();\nimport { useSelector } from \"react-redux\";\nimport { createPortal } from \"react-dom\";\nimport { useEffect, useRef } from \"react\";\nimport useModal from \"../hook/useModal\";\nimport { ObjectUtils } from \"../utils/ObjectUtil\";\nimport { ModalSet } from \"../../modal/ModalSet\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst M_TYPE = {\n  MENU: 'MENU',\n  LAYER: 'LAYER',\n  RENDERLESS: 'RENDERLESS',\n  TOOLTIP: 'TOOLTIP'\n};\nfunction ModalContainer() {\n  _s();\n  const modal = useModal();\n  const modalList = useSelector(state => state.modalReducer);\n  const topComponentRef = useRef(null);\n  const handleRef = node => {\n    if (node) {\n      topComponentRef.current = node;\n    }\n  };\n  useEffect(() => {\n    if (ObjectUtils.isEmpty(modalList.list)) {\n      return;\n    }\n    const {\n      type,\n      modalName\n    } = modalList.list[modalList.list.length - 1];\n    const onClickCaptureEvent = e => {\n      if (topComponentRef.current && !topComponentRef.current.contains(e.target)) {\n        modal.closeAndLockModal(modalName);\n        window.removeEventListener('mousedown', onClickCaptureEvent, true);\n        window.removeEventListener('keydown', onKeydownCaptureEvent, true);\n      }\n    };\n    const onClickBubbleEvent = e => {\n      modal.unlockModal();\n      window.removeEventListener('click', onClickBubbleEvent, false);\n    };\n    const onKeydownCaptureEvent = e => {\n      if (e.keyCode === 27) {\n        modal.closeModal(modalName);\n        window.removeEventListener('keydown', onKeydownCaptureEvent, true);\n        window.removeEventListener('mousedown', onClickCaptureEvent, true);\n        window.removeEventListener('click', onClickBubbleEvent, false);\n      }\n    };\n\n    // 모든 흐름이 끝난 후 이벤트 리스너를 붙이도록 비동기적으로 처리\n    const attachListenerTimer = setTimeout(() => {\n      if (type === M_TYPE.LAYER || type === M_TYPE.MENU || type === M_TYPE.RENDERLESS) {\n        window.addEventListener('click', onClickBubbleEvent, false);\n        window.addEventListener('mousedown', onClickCaptureEvent, true); // true: capturing, false: bubbling\n      }\n      if (type === M_TYPE.MENU || type === M_TYPE.LAYER || type === M_TYPE.RENDERLESS) {\n        window.addEventListener('keydown', onKeydownCaptureEvent, true);\n      }\n    }, 10);\n    return () => {\n      clearTimeout(attachListenerTimer);\n      window.removeEventListener('keydown', onKeydownCaptureEvent, true);\n      window.removeEventListener('mousedown', onClickCaptureEvent, true);\n      // window.removeEventListener('click', onClickBubbleEvent, false)\n      // bubbling의 경우에는 미리 삭제하면 안되기 때문에 주석처리\n    };\n  }, [modalList.list]);\n  let topIndex = 0;\n  let topScrollIndex = 0;\n  modalList.list.forEach(({\n    modalName,\n    type,\n    props\n  }, index) => {\n    if (type === M_TYPE.MENU || type === M_TYPE.LAYER || type === M_TYPE.RENDERLESS) {\n      topIndex = index;\n    }\n    if (type === M_TYPE.LAYER || type === M_TYPE.MENU) {\n      topScrollIndex = index;\n    }\n  });\n  const lastIndex = modalList.list.length - 1;\n  const renderModal = modalList.list.filter(({\n    modalName,\n    type,\n    props\n  }) => {\n    if (ObjectUtils.isEmpty(modalName) || ObjectUtils.isEmpty(type)) {\n      return false;\n    }\n    if (type === M_TYPE.RENDERLESS) {\n      if (props.ref) {\n        topComponentRef.current = props.ref;\n      }\n      return false;\n    }\n    return true;\n  }).map(({\n    modalName,\n    type,\n    onopen,\n    onclose,\n    props\n  }, index) => {\n    let windowBlocked = false;\n    if (type === M_TYPE.LAYER && index === lastIndex) {\n      windowBlocked = true;\n    }\n    if (index === topIndex) {\n      const ModalComponent = ModalSet[modalName];\n      return /*#__PURE__*/_jsxDEV(ModalComponent, {\n        scrollable: true,\n        modalRef: handleRef,\n        windowBlocked: windowBlocked,\n        ...props\n      }, modalName, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 20\n      }, this);\n    }\n    const ModalComponent = ModalSet[modalName];\n    let scrollable = false;\n    if ((type === M_TYPE.LAYER || type === M_TYPE.MENU) && index === topScrollIndex) {\n      scrollable = true;\n    }\n    return /*#__PURE__*/_jsxDEV(ModalComponent, {\n      scrollable: scrollable,\n      windowBlocked: windowBlocked,\n      ...props\n    }, modalName, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 16\n    }, this);\n  });\n  return /*#__PURE__*/createPortal(/*#__PURE__*/_jsxDEV(_Fragment, {\n    children: renderModal\n  }, void 0, false), document.getElementById('root'));\n}\n_s(ModalContainer, \"n0Ri6zPKNqCmFJrmUfpbQDTtyMI=\", false, function () {\n  return [useModal, useSelector];\n});\n_c = ModalContainer;\nexport default ModalContainer;\nvar _c;\n$RefreshReg$(_c, \"ModalContainer\");","map":{"version":3,"names":["useSelector","createPortal","useEffect","useRef","useModal","ObjectUtils","ModalSet","jsxDEV","_jsxDEV","Fragment","_Fragment","M_TYPE","MENU","LAYER","RENDERLESS","TOOLTIP","ModalContainer","_s","modal","modalList","state","modalReducer","topComponentRef","handleRef","node","current","isEmpty","list","type","modalName","length","onClickCaptureEvent","e","contains","target","closeAndLockModal","window","removeEventListener","onKeydownCaptureEvent","onClickBubbleEvent","unlockModal","keyCode","closeModal","attachListenerTimer","setTimeout","addEventListener","clearTimeout","topIndex","topScrollIndex","forEach","props","index","lastIndex","renderModal","filter","ref","map","onopen","onclose","windowBlocked","ModalComponent","scrollable","modalRef","fileName","_jsxFileName","lineNumber","columnNumber","children","document","getElementById","_c","$RefreshReg$"],"sources":["/Users/chan/Baektracker/src/main/frontend/src/js/setup/modal/ModalContainer.js"],"sourcesContent":["import {useSelector} from \"react-redux\";\nimport {createPortal} from \"react-dom\";\nimport {useEffect, useRef} from \"react\";\nimport useModal from \"../hook/useModal\";\nimport {ObjectUtils} from \"../utils/ObjectUtil\";\nimport {ModalSet} from \"../../modal/ModalSet\";\n\nconst M_TYPE = {\n    MENU: 'MENU',\n    LAYER: 'LAYER',\n    RENDERLESS: 'RENDERLESS',\n    TOOLTIP: 'TOOLTIP'\n}\n\nfunction ModalContainer(){\n    const modal = useModal();\n    const modalList : Object<string,Array> = useSelector(state=>state.modalReducer);\n    const topComponentRef = useRef(null);\n\n    const handleRef = (node) => {\n        if (node) {\n            topComponentRef.current = node;\n        }\n    };\n\n    useEffect(()=>{\n        if(ObjectUtils.isEmpty(modalList.list)){\n            return;\n        }\n\n        const {type, modalName} = modalList.list[modalList.list.length-1];\n        const onClickCaptureEvent = (e: MouseEvent)=>{\n            if(topComponentRef.current && !topComponentRef.current.contains(e.target)){\n                modal.closeAndLockModal(modalName)\n                window.removeEventListener('mousedown', onClickCaptureEvent, true)\n                window.removeEventListener('keydown', onKeydownCaptureEvent, true)\n            }\n        }\n\n        const onClickBubbleEvent = (e)=>{\n            modal.unlockModal()\n            window.removeEventListener('click', onClickBubbleEvent, false)\n        }\n\n        const onKeydownCaptureEvent = (e: KeyboardEvent)=>{\n            if(e.keyCode === 27){\n                modal.closeModal(modalName);\n\n                window.removeEventListener('keydown', onKeydownCaptureEvent, true)\n                window.removeEventListener('mousedown', onClickCaptureEvent, true)\n                window.removeEventListener('click', onClickBubbleEvent, false)\n            }\n        }\n\n        // 모든 흐름이 끝난 후 이벤트 리스너를 붙이도록 비동기적으로 처리\n        const attachListenerTimer = setTimeout(()=>{\n            if(type === M_TYPE.LAYER || type === M_TYPE.MENU || type === M_TYPE.RENDERLESS){\n                window.addEventListener('click', onClickBubbleEvent, false)\n                window.addEventListener('mousedown', onClickCaptureEvent, true) // true: capturing, false: bubbling\n            }\n\n            if(type === M_TYPE.MENU || type === M_TYPE.LAYER || type === M_TYPE.RENDERLESS){\n                window.addEventListener('keydown', onKeydownCaptureEvent, true)\n            }\n        }, 10)\n\n        return ()=>{\n            clearTimeout(attachListenerTimer);\n            window.removeEventListener('keydown', onKeydownCaptureEvent, true)\n            window.removeEventListener('mousedown', onClickCaptureEvent, true)\n            // window.removeEventListener('click', onClickBubbleEvent, false)\n            // bubbling의 경우에는 미리 삭제하면 안되기 때문에 주석처리\n        }\n    },[modalList.list])\n\n    let topIndex = 0;\n    let topScrollIndex = 0;\n    modalList.list.forEach(({modalName, type, props}, index)=>{\n        if(type === M_TYPE.MENU || type === M_TYPE.LAYER || type === M_TYPE.RENDERLESS){\n            topIndex = index\n        }\n        if(type === M_TYPE.LAYER || type === M_TYPE.MENU){\n            topScrollIndex = index\n        }\n    })\n\n    const lastIndex = modalList.list.length - 1;\n    const renderModal = modalList.list.filter(({modalName, type, props})=>{\n        if(ObjectUtils.isEmpty(modalName) || ObjectUtils.isEmpty(type)){\n            return false;\n        }\n        if(type === M_TYPE.RENDERLESS){\n            if(props.ref){\n                topComponentRef.current = props.ref;\n            }\n            return false;\n        }\n        return true;\n    }).map(({modalName, type, onopen, onclose, props}, index)=>{\n        let windowBlocked = false;\n        if(type === M_TYPE.LAYER && index === lastIndex){\n            windowBlocked = true;\n        }\n\n        if(index === topIndex){\n            const ModalComponent = ModalSet[modalName];\n            return <ModalComponent scrollable={true} modalRef={handleRef} windowBlocked={windowBlocked} key={modalName} {...props}/>\n        }\n\n        const ModalComponent = ModalSet[modalName];\n\n        let scrollable = false;\n        if((type === M_TYPE.LAYER || type === M_TYPE.MENU) && index === topScrollIndex){\n            scrollable = true;\n        }\n\n        return <ModalComponent scrollable={scrollable} windowBlocked={windowBlocked} key={modalName} {...props}/>\n    });\n\n    return createPortal(\n        <>\n            {renderModal}\n        </>, document.getElementById('root')\n    )\n}\n\nexport default ModalContainer;"],"mappings":";;AAAA,SAAQA,WAAW,QAAO,aAAa;AACvC,SAAQC,YAAY,QAAO,WAAW;AACtC,SAAQC,SAAS,EAAEC,MAAM,QAAO,OAAO;AACvC,OAAOC,QAAQ,MAAM,kBAAkB;AACvC,SAAQC,WAAW,QAAO,qBAAqB;AAC/C,SAAQC,QAAQ,QAAO,sBAAsB;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAE9C,MAAMC,MAAM,GAAG;EACXC,IAAI,EAAE,MAAM;EACZC,KAAK,EAAE,OAAO;EACdC,UAAU,EAAE,YAAY;EACxBC,OAAO,EAAE;AACb,CAAC;AAED,SAASC,cAAcA,CAAA,EAAE;EAAAC,EAAA;EACrB,MAAMC,KAAK,GAAGd,QAAQ,CAAC,CAAC;EACxB,MAAMe,SAAgC,GAAGnB,WAAW,CAACoB,KAAK,IAAEA,KAAK,CAACC,YAAY,CAAC;EAC/E,MAAMC,eAAe,GAAGnB,MAAM,CAAC,IAAI,CAAC;EAEpC,MAAMoB,SAAS,GAAIC,IAAI,IAAK;IACxB,IAAIA,IAAI,EAAE;MACNF,eAAe,CAACG,OAAO,GAAGD,IAAI;IAClC;EACJ,CAAC;EAEDtB,SAAS,CAAC,MAAI;IACV,IAAGG,WAAW,CAACqB,OAAO,CAACP,SAAS,CAACQ,IAAI,CAAC,EAAC;MACnC;IACJ;IAEA,MAAM;MAACC,IAAI;MAAEC;IAAS,CAAC,GAAGV,SAAS,CAACQ,IAAI,CAACR,SAAS,CAACQ,IAAI,CAACG,MAAM,GAAC,CAAC,CAAC;IACjE,MAAMC,mBAAmB,GAAIC,CAAa,IAAG;MACzC,IAAGV,eAAe,CAACG,OAAO,IAAI,CAACH,eAAe,CAACG,OAAO,CAACQ,QAAQ,CAACD,CAAC,CAACE,MAAM,CAAC,EAAC;QACtEhB,KAAK,CAACiB,iBAAiB,CAACN,SAAS,CAAC;QAClCO,MAAM,CAACC,mBAAmB,CAAC,WAAW,EAAEN,mBAAmB,EAAE,IAAI,CAAC;QAClEK,MAAM,CAACC,mBAAmB,CAAC,SAAS,EAAEC,qBAAqB,EAAE,IAAI,CAAC;MACtE;IACJ,CAAC;IAED,MAAMC,kBAAkB,GAAIP,CAAC,IAAG;MAC5Bd,KAAK,CAACsB,WAAW,CAAC,CAAC;MACnBJ,MAAM,CAACC,mBAAmB,CAAC,OAAO,EAAEE,kBAAkB,EAAE,KAAK,CAAC;IAClE,CAAC;IAED,MAAMD,qBAAqB,GAAIN,CAAgB,IAAG;MAC9C,IAAGA,CAAC,CAACS,OAAO,KAAK,EAAE,EAAC;QAChBvB,KAAK,CAACwB,UAAU,CAACb,SAAS,CAAC;QAE3BO,MAAM,CAACC,mBAAmB,CAAC,SAAS,EAAEC,qBAAqB,EAAE,IAAI,CAAC;QAClEF,MAAM,CAACC,mBAAmB,CAAC,WAAW,EAAEN,mBAAmB,EAAE,IAAI,CAAC;QAClEK,MAAM,CAACC,mBAAmB,CAAC,OAAO,EAAEE,kBAAkB,EAAE,KAAK,CAAC;MAClE;IACJ,CAAC;;IAED;IACA,MAAMI,mBAAmB,GAAGC,UAAU,CAAC,MAAI;MACvC,IAAGhB,IAAI,KAAKjB,MAAM,CAACE,KAAK,IAAIe,IAAI,KAAKjB,MAAM,CAACC,IAAI,IAAIgB,IAAI,KAAKjB,MAAM,CAACG,UAAU,EAAC;QAC3EsB,MAAM,CAACS,gBAAgB,CAAC,OAAO,EAAEN,kBAAkB,EAAE,KAAK,CAAC;QAC3DH,MAAM,CAACS,gBAAgB,CAAC,WAAW,EAAEd,mBAAmB,EAAE,IAAI,CAAC,EAAC;MACpE;MAEA,IAAGH,IAAI,KAAKjB,MAAM,CAACC,IAAI,IAAIgB,IAAI,KAAKjB,MAAM,CAACE,KAAK,IAAIe,IAAI,KAAKjB,MAAM,CAACG,UAAU,EAAC;QAC3EsB,MAAM,CAACS,gBAAgB,CAAC,SAAS,EAAEP,qBAAqB,EAAE,IAAI,CAAC;MACnE;IACJ,CAAC,EAAE,EAAE,CAAC;IAEN,OAAO,MAAI;MACPQ,YAAY,CAACH,mBAAmB,CAAC;MACjCP,MAAM,CAACC,mBAAmB,CAAC,SAAS,EAAEC,qBAAqB,EAAE,IAAI,CAAC;MAClEF,MAAM,CAACC,mBAAmB,CAAC,WAAW,EAAEN,mBAAmB,EAAE,IAAI,CAAC;MAClE;MACA;IACJ,CAAC;EACL,CAAC,EAAC,CAACZ,SAAS,CAACQ,IAAI,CAAC,CAAC;EAEnB,IAAIoB,QAAQ,GAAG,CAAC;EAChB,IAAIC,cAAc,GAAG,CAAC;EACtB7B,SAAS,CAACQ,IAAI,CAACsB,OAAO,CAAC,CAAC;IAACpB,SAAS;IAAED,IAAI;IAAEsB;EAAK,CAAC,EAAEC,KAAK,KAAG;IACtD,IAAGvB,IAAI,KAAKjB,MAAM,CAACC,IAAI,IAAIgB,IAAI,KAAKjB,MAAM,CAACE,KAAK,IAAIe,IAAI,KAAKjB,MAAM,CAACG,UAAU,EAAC;MAC3EiC,QAAQ,GAAGI,KAAK;IACpB;IACA,IAAGvB,IAAI,KAAKjB,MAAM,CAACE,KAAK,IAAIe,IAAI,KAAKjB,MAAM,CAACC,IAAI,EAAC;MAC7CoC,cAAc,GAAGG,KAAK;IAC1B;EACJ,CAAC,CAAC;EAEF,MAAMC,SAAS,GAAGjC,SAAS,CAACQ,IAAI,CAACG,MAAM,GAAG,CAAC;EAC3C,MAAMuB,WAAW,GAAGlC,SAAS,CAACQ,IAAI,CAAC2B,MAAM,CAAC,CAAC;IAACzB,SAAS;IAAED,IAAI;IAAEsB;EAAK,CAAC,KAAG;IAClE,IAAG7C,WAAW,CAACqB,OAAO,CAACG,SAAS,CAAC,IAAIxB,WAAW,CAACqB,OAAO,CAACE,IAAI,CAAC,EAAC;MAC3D,OAAO,KAAK;IAChB;IACA,IAAGA,IAAI,KAAKjB,MAAM,CAACG,UAAU,EAAC;MAC1B,IAAGoC,KAAK,CAACK,GAAG,EAAC;QACTjC,eAAe,CAACG,OAAO,GAAGyB,KAAK,CAACK,GAAG;MACvC;MACA,OAAO,KAAK;IAChB;IACA,OAAO,IAAI;EACf,CAAC,CAAC,CAACC,GAAG,CAAC,CAAC;IAAC3B,SAAS;IAAED,IAAI;IAAE6B,MAAM;IAAEC,OAAO;IAAER;EAAK,CAAC,EAAEC,KAAK,KAAG;IACvD,IAAIQ,aAAa,GAAG,KAAK;IACzB,IAAG/B,IAAI,KAAKjB,MAAM,CAACE,KAAK,IAAIsC,KAAK,KAAKC,SAAS,EAAC;MAC5CO,aAAa,GAAG,IAAI;IACxB;IAEA,IAAGR,KAAK,KAAKJ,QAAQ,EAAC;MAClB,MAAMa,cAAc,GAAGtD,QAAQ,CAACuB,SAAS,CAAC;MAC1C,oBAAOrB,OAAA,CAACoD,cAAc;QAACC,UAAU,EAAE,IAAK;QAACC,QAAQ,EAAEvC,SAAU;QAACoC,aAAa,EAAEA,aAAc;QAAA,GAAqBT;MAAK,GAApBrB,SAAS;QAAAkC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAa,CAAC;IAC5H;IAEA,MAAMN,cAAc,GAAGtD,QAAQ,CAACuB,SAAS,CAAC;IAE1C,IAAIgC,UAAU,GAAG,KAAK;IACtB,IAAG,CAACjC,IAAI,KAAKjB,MAAM,CAACE,KAAK,IAAIe,IAAI,KAAKjB,MAAM,CAACC,IAAI,KAAKuC,KAAK,KAAKH,cAAc,EAAC;MAC3Ea,UAAU,GAAG,IAAI;IACrB;IAEA,oBAAOrD,OAAA,CAACoD,cAAc;MAACC,UAAU,EAAEA,UAAW;MAACF,aAAa,EAAEA,aAAc;MAAA,GAAqBT;IAAK,GAApBrB,SAAS;MAAAkC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAa,CAAC;EAC7G,CAAC,CAAC;EAEF,oBAAOjE,YAAY,cACfO,OAAA,CAAAE,SAAA;IAAAyD,QAAA,EACKd;EAAW,gBACd,CAAC,EAAEe,QAAQ,CAACC,cAAc,CAAC,MAAM,CACvC,CAAC;AACL;AAACpD,EAAA,CA9GQD,cAAc;EAAA,QACLZ,QAAQ,EACmBJ,WAAW;AAAA;AAAAsE,EAAA,GAF/CtD,cAAc;AAgHvB,eAAeA,cAAc;AAAC,IAAAsD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}